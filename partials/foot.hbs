<!-- JAVASCRIPT -->
<script src="/js/main.js"></script>
<script>
  function listTweets(data) {
    var output = '<ul data-role="listview" class="twitter-feed__container">';

    $.each(data, function(key, val) {
      var text = data[key].text;
      var thumbnail = data[key].user.profile_image_url;
      var name = data[key].user.name;

      text=text.replace(/[A-Za-z]+:\/\/[A-Za-z0-9-_]+\.[A-Za-z0-9-_:%&~\?\/.=]+/g, function(i) {
        var url=i.link(i);
        return url;
      });

      text=text.replace(/[@]+[A-Za-z0-9-_]+/g, function(i) {
        var item = i.replace("@",'');
        var	url = i.link("http://twitter.com/"+ item);
        return url;
      });

      text=text.replace(/[#]+[A-Za-z0-9-_]+/g, function(i) {
        var item = i.replace("#", '%23');
        var url = i.link("http://search.twitter.com/search?q="+item);
        return url;
      });

      output += '<li class="twitter-feed__item">';
      output += '<svg class="twitter-feed__icon"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/images/icons/sprite.svg#twitter"></use></svg>' + '<span>' + text + '</span>';
      output += '</li>';
    }); //go through each tweet
    output += '</ul>';
    $('.twitter-feed').html(output);
  }
</script>
<script src="/twitter/tweets_json.php?count=2&callback=listTweets"></script>
<script>
  $(document).ready(function() {
    var refreshID = (function() {
      $.getJSON('/twitter/tweets_json.php?count=2', function(data) {
        listTweets(data);
        $('.twitter-feed').trigger('create');
      });
    });
  });

  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-86474726-1', 'auto');
  ga('send', 'pageview');

  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/sw.js');
  }

  {{#if pubDate}}
    var disqus_shortname = 'alexmclapperton';
    var disqus_title = '{{{title}}}';
    var disqus_url = '{{{global.url}}}/blog/{{{slug}}}';
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  {{/if}}
</script>

</body>
</html>
